<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Calculadora de Notas — Fundamental e Médio</title>
<meta name="description" content="Calculadora de médias com interface limpa. Fundamental e Médio. Média Anual, P2 mínima e Tri mínimo, com Exame Final no Médio.">
<style>
:root{
  --bg:#070a17; --bg2:#090d1f;
  --card:#0e1430; --glass:rgba(255,255,255,.04);
  --line:#212a56; --line2:#2b356b;
  --txt:#edf2ff; --muted:#9fb0ea; --muted2:#7b8ac3;
  --brand1:#6aa5ff; --brand2:#7ef7d4; --brand3:#b388ff;
  --ok:#19d49b; --warn:#ffb020; --bad:#ff6a6f;
  --shadow:0 18px 50px rgba(0,0,0,.55), inset 0 1px 0 rgba(255,255,255,.03);
  --radius:18px;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; color:var(--txt);
  font:16px/1.55 Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  background:
    radial-gradient(1300px 800px at -10% -10%, #1a2150 0%, rgba(26,33,80,0) 55%),
    radial-gradient(1100px 700px at 110% 0%, #14255a 0%, rgba(20,37,90,0) 55%),
    linear-gradient(180deg, var(--bg), var(--bg2));
  overflow-x:hidden;
}

/* orbes + rede sutil (estilo original) */
.orb{position:fixed; border-radius:50%; filter:blur(40px); opacity:.35; mix-blend-mode:screen; z-index:-2}
.o1{width:560px;height:560px;background:radial-gradient(circle at 30% 30%,#6aa5ff,transparent 60%);top:-160px;left:-140px;animation:f1 16s ease-in-out infinite}
.o2{width:620px;height:620px;background:radial-gradient(circle at 70% 40%,#7ef7d4,transparent 55%);bottom:-180px;right:-160px;animation:f2 19s ease-in-out infinite}
.o3{width:420px;height:420px;background:radial-gradient(circle at 50% 50%,#b388ff,transparent 60%);top:38%;left:58%;animation:f3 21s ease-in-out infinite}
@keyframes f1{0%,100%{transform:translate(0,0)}50%{transform:translate(30px,20px)}}
@keyframes f2{0%,100%{transform:translate(0,0)}50%{transform:translate(-36px,-26px)}}
@keyframes f3{0%,100%{transform:translate(0,0)}50%{transform:translate(-26px,22px)}}
.grid-bg{
  position:fixed; inset:0; background:
  linear-gradient(to right, rgba(255,255,255,.04) 1px, transparent 1px) 0 0/40px 40px,
  linear-gradient(to bottom, rgba(255,255,255,.04) 1px, transparent 1px) 0 0/40px 40px;
  mask-image: radial-gradient(1000px 600px at 50% 30%, #000 40%, transparent 80%);
  z-index:-1; opacity:.22;
}

.wrap{max-width:1200px;margin:0 auto;padding:32px 16px 64px}
header{text-align:center;margin-bottom:18px}
.kicker{display:inline-flex;gap:8px;align-items:center;padding:6px 12px;border:1px solid var(--line);border-radius:999px;background:linear-gradient(180deg,var(--glass),transparent);backdrop-filter:blur(6px);color:var(--muted);font-size:12px}
.logoDot{width:8px;height:8px;border-radius:50%;background:linear-gradient(90deg,var(--brand1),var(--brand3));box-shadow:0 0 14px rgba(106,165,255,.9)}
.title{margin:10px 0 6px;font-weight:900;font-size:clamp(24px,3.4vw,34px);letter-spacing:.2px}
.sub{margin:0;color:var(--muted);font-size:14px}

.tabs{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-top:16px}
.tab{
  background:linear-gradient(180deg,#0d1333,#0a102b);
  border:1px solid var(--line);border-radius:14px;padding:10px 16px;
  font-weight:800;color:#dfe6ff;cursor:pointer;transition:.2s transform,.25s box-shadow,.25s background;
  box-shadow:0 10px 24px rgba(0,0,0,.35)
}
.tab:hover{transform:translateY(-1px)}
.tab.active{background:linear-gradient(90deg,var(--brand1),var(--brand3));color:#fff;box-shadow:0 0 22px rgba(106,165,255,.35)}

.layout{display:grid;grid-template-columns:1.15fr .85fr;gap:18px}
@media (max-width: 980px){.layout{grid-template-columns:1fr}}

.card{
  background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,0)), var(--card);
  border:1px solid var(--line); border-radius:var(--radius); box-shadow:var(--shadow)
}
.card .hd{padding:16px 18px;border-bottom:1px solid var(--line);display:flex;align-items:center;gap:10px}
.card .hd h2{margin:0;font-size:16px}
.card .bd{padding:18px}

/* chips */
.actions{display:flex;gap:10px;flex-wrap:wrap}
.chip{
  position:relative; isolation:isolate;
  background:linear-gradient(180deg,#101743,#0d143a);
  border:1px solid var(--line2); color:#dfe6ff; padding:10px 14px;border-radius:999px;
  font-weight:800;cursor:pointer;transition:.12s transform,.2s border-color,.2s box-shadow,.2s background;
}
.chip::after{
  content:""; position:absolute; inset:0; border-radius:inherit; opacity:0; z-index:-1;
  background:radial-gradient(120px 60px at 50% 50%, #6aa5ff33, transparent 60%);
  transition:.2s opacity;
}
.chip:hover{transform:translateY(-1px);border-color:#3c65ff}
.chip:hover::after{opacity:1}
.chip.active{border-color:#3c65ff;box-shadow:0 0 0 3px rgba(60,101,255,.22) inset}

/* inputs */
label{display:block;font-size:12px;color:var(--muted);margin:0 0 6px 4px}
.inputs{display:grid;grid-template-columns:repeat(3,minmax(180px,1fr));gap:12px;margin-top:14px}
@media (max-width:700px){.inputs{grid-template-columns:1fr}}
.inputWrap{
  position:relative;border:1px solid var(--line);border-radius:14px;background:linear-gradient(180deg,var(--glass),transparent);
  transition:.2s border,.2s box-shadow
}
.inputWrap:focus-within{border-color:#3c65ff;box-shadow:0 0 0 4px rgba(60,101,255,.12)}
.inputIcon{position:absolute;left:10px;top:50%;transform:translateY(-50%);opacity:.8}
input{
  width:100%;padding:12px 12px 12px 36px;border:0;background:transparent;color:var(--txt);font-size:16px;outline:none
}
input::placeholder{color:#6e76a5}
.hint{font-size:12px;color:var(--muted2);margin-top:10px}
.sep{height:1px;background:linear-gradient(90deg,transparent,#2b356b,transparent);margin:16px 0}

/* botões */
.btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:6px}
.btn{
  position:relative;isolation:isolate;
  border:1px solid #2a3567;background:linear-gradient(180deg,#1a2352,#121a45);
  color:#eaf0ff;padding:12px 14px;border-radius:12px;font-weight:900;cursor:pointer;
  transition:transform .12s ease,box-shadow .2s ease,border-color .2s ease;box-shadow:0 10px 22px rgba(17,24,39,.36)
}
.btn:hover{transform:translateY(-1px);border-color:#3c65ff}
.btn.ghost{background:transparent}
.btn.primary{
  background:linear-gradient(180deg,#12215a,#0f1a49);
  border-color:#3a5bff66; box-shadow:0 0 22px #3958ff22, inset 0 0 18px #6aa5ff15, inset 0 0 18px #b388ff15;
}
.btn .glow{content:"";position:absolute;inset:0;border-radius:inherit;z-index:-1;background:conic-gradient(from 0deg,rgba(106,165,255,.30),rgba(126,247,212,.30),rgba(179,136,255,.30),rgba(106,165,255,.30));filter:blur(18px);opacity:0;transition:.25s}
.btn:hover .glow{opacity:.8}

/* outputs */
.outs{display:grid;gap:12px}
.kpi{
  display:flex;align-items:center;gap:16px;background:linear-gradient(180deg,var(--glass),transparent);
  border:1px solid var(--line);border-radius:14px;padding:14px
}
.gauge{display:flex;align-items:center;gap:16px}
.ring{width:140px;height:140px;position:relative}
.ring circle{fill:none;stroke-width:12;stroke-linecap:round;transform:rotate(-90deg);transform-origin:50% 50%}
.ring .bg{stroke:#1e2647}
.ring .fg{stroke:url(#grad1);stroke-dasharray:439.822;stroke-dashoffset:439.822;transition:stroke-dashoffset .6s ease}
.ginfo{display:flex;flex-direction:column;gap:4px}
.gmain{font-size:30px;font-weight:900;letter-spacing:.3px}
.gsub{font-size:12px;color:var(--muted2)}
.status{font-size:13px;color:var(--muted2)}
/* MA no centro do gauge */
.centerMA{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none}
.centerMA .big{font-size:24px;font-weight:900}
.centerMA .sub{font-size:11px;color:var(--muted2);margin-top:2px;text-align:center}

.pill{
  display:flex;align-items:center;justify-content:space-between;gap:12px;
  background:linear-gradient(180deg,var(--glass),transparent);
  border:1px solid var(--line);padding:14px;border-radius:14px;font-variant-numeric:tabular-nums
}
.tag{font-size:12px;padding:4px 10px;border-radius:999px;border:1px solid var(--line);color:var(--muted)}
.ok{color:var(--ok);border-color:#1b6a52;background:linear-gradient(180deg,rgba(13,214,140,.12),rgba(13,214,140,0))}
.bad{color:var(--bad);border-color:#6a1f28;background:linear-gradient(180deg,rgba(255,107,115,.12),rgba(255,107,115,0))}
.mid{color:var(--warn);border-color:#6a4e1f;background:linear-gradient(180deg,rgba(255,196,88,.12),rgba(255,196,88,0))}

.tableCard{background:linear-gradient(180deg,var(--glass),transparent);border:1px solid var(--line);border-radius:12px}
.tableCard table{width:100%;border-collapse:collapse}
.tableCard th,.tableCard td{padding:10px 12px;border-bottom:1px dashed #2b356b;text-align:left}
.tableCard th{color:#c9d6ff}
.tableCard tr:last-child td{border-bottom:0}

/* toasts */
.toast{position:fixed;right:16px;bottom:16px;background:linear-gradient(180deg,#0f173d,#0b1234);color:#eaf0ff;border:1px solid #2a3567;border-radius:12px;padding:12px 14px;box-shadow:var(--shadow);opacity:0;transform:translateY(8px);pointer-events:none;transition:.3s}
.toast.show{opacity:1;transform:none}

/* assinatura */
.signature{position:fixed;right:14px;bottom:12px;font-size:12px;color:var(--muted);background:linear-gradient(180deg,#0b1130,#0a0f28);border:1px solid #223064;border-radius:999px;padding:6px 10px;opacity:.8}
.signature:hover{opacity:1}

/* acessibilidade */
.visually-hidden{position:absolute;left:-10000px;top:auto;width:1px;height:1px;overflow:hidden}
</style>
</head>
<body>
<div class="orb o1"></div><div class="orb o2"></div><div class="orb o3"></div><div class="grid-bg"></div>

<div class="wrap">
  <header>
    <span class="kicker"><span class="logoDot"></span> Calculadora de Notas</span>
    <h1 class="title">Ensino Fundamental & Ensino Médio</h1>
    <p class="sub">Cálculo limpo e direto. Sem fórmulas na tela.</p>
    <div class="tabs" role="tablist" aria-label="Modos">
      <button id="tabFund" class="tab active" role="tab" aria-selected="true" aria-controls="panelFund" onclick="setTab('fund')">Ensino Fundamental</button>
      <button id="tabMed"  class="tab" role="tab" aria-selected="false" aria-controls="panelMed"  onclick="setTab('med')">Ensino Médio</button>
    </div>
  </header>

  <main class="layout">
    <!-- Entradas -->
    <section class="card" aria-labelledby="inTitle">
      <div class="hd"><h2 id="inTitle">Entradas</h2></div>
      <div class="bd">
        <!-- ações -->
        <div class="actions" id="actions"></div>

        <div class="inputs" style="margin-top:10px">
          <div>
            <label for="goalMA">Meta de MA</label>
            <div class="inputWrap"><svg class="inputIcon" width="18" height="18" viewBox="0 0 24 24"><path fill="#8aa1ff" d="M12 3l9 4.5v9L12 21 3 16.5v-9z"/></svg><input id="goalMA" inputmode="decimal" value="7,00" placeholder="7,0"></div>
          </div>
          <div id="goalTxBlock">
            <label for="goalTx">Meta de Tx</label>
            <div class="inputWrap"><svg class="inputIcon" width="18" height="18" viewBox="0 0 24 24"><path fill="#86f7d9" d="M3 5h18v2H3zm0 6h18v2H3zm0 6h18v2H3z"/></svg><input id="goalTx" inputmode="decimal" value="7,00" placeholder="7,0"></div>
          </div>
        </div>

        <div class="sep"></div>

        <!-- campos -->
        <div id="inputsArea" class="inputs"></div>

        <p class="hint">Notas entre 0 e 10.</p>

        <div class="sep"></div>

        <div class="btns">
          <button class="btn primary" id="btnCalc"><span class="glow"></span>Calcular</button>
          <button class="btn ghost" id="btnLimpar"><span class="glow"></span>Limpar</button>
          <button class="btn ghost" id="btnExemplo"><span class="glow"></span>Exemplo</button>
        </div>
      </div>
    </section>

    <!-- Resultados -->
    <section class="card" aria-labelledby="outTitle">
      <div class="hd"><h2 id="outTitle">Resultados</h2></div>
      <div class="bd outs">
        <div class="kpi">
          <div class="gauge">
            <div class="ring">
              <svg class="ring" viewBox="0 0 140 140" aria-hidden="true">
                <defs>
                  <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" stop-color="#6aa5ff"/>
                    <stop offset="50%" stop-color="#7ef7d4"/>
                    <stop offset="100%" stop-color="#b388ff"/>
                  </linearGradient>
                </defs>
                <circle class="bg" cx="70" cy="70" r="70"></circle>
                <circle class="fg" id="fg" cx="70" cy="70" r="70"></circle>
              </svg>
              <!-- MA central -->
              <div class="centerMA">
                <div style="display:flex;flex-direction:column;align-items:center">
                  <div class="big" id="maCenter">—</div>
                  <div class="sub">Média Anual</div>
                </div>
              </div>
            </div>
            <div class="ginfo">
              <div class="gmain" id="maVal">MA —</div>
              <div class="gsub" id="gsub">Meta: 7,00</div>
              <div class="status" id="status">Status: —</div>
            </div>
          </div>
        </div>

        <div class="pill"><div>Resultado principal</div><div class="tag" id="mainTag">—</div></div>
        <div class="pill"><div>Exame Final</div><div class="tag" id="efTag">—</div></div>

        <div class="tableCard">
          <table>
            <thead>
              <tr><th>Parâmetro</th><th>Valor</th><th>Descrição</th></tr>
            </thead>
            <tbody id="tbl"></tbody>
          </table>
        </div>
      </div>
    </section>
  </main>
</div>

<div id="toast" class="toast" role="status" aria-live="polite">Ok</div>
<div class="signature">Site feito por: @luizgmrzzx</div>

<script>
/* ===== Util ===== */
const $=s=>document.querySelector(s), $$=s=>document.querySelectorAll(s);
const fmt=n=>Number.isFinite(n)?n.toLocaleString('pt-BR',{minimumFractionDigits:2,maximumFractionDigits:2}):'—';
const CIRC=439.822;
function setGauge(ratio){$('#fg').style.strokeDashoffset=(CIRC*(1-Math.max(0,Math.min(1,ratio)))).toFixed(2)}
function toast(msg){const t=$('#toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),1500)}
function toNum(s){if(typeof s!=='string')return NaN;const t=s.trim().replace(/\s+/g,'').replace(',','.');const n=Number(t);return Number.isFinite(n)?n:NaN}
function read(id){return toNum($('#'+id)?.value??'')}
function setTag(id,val,kind){const el=$(id);el.textContent=val;el.className='tag'+(kind?' '+kind:'')}
function setTable(rows){$('#tbl').innerHTML=rows.map(([k,v,o])=>`<tr><td>${k}</td><td>${v}</td><td>${o||''}</td></tr>`).join('')}

/* ===== Fórmulas internas (não exibidas) ===== */
/* Médio */
const MA_medio=(T1,T2,T3)=>(2*T1+2*T2+3*T3)/7;
function EF_minimo(MA){ return (50 - 7*MA)/3 } // somente resultado
function P2min_medio(T1,T2,P1,S,goalMA){const T3need=(7*goalMA-2*T1-2*T2)/3;return 2*T3need-P1-2*S}
/* Fundamental */
const TX_fund=(P1,P2,Tri,S)=>(P1+P2+Tri+3*S)/3;
const MA_fund=(T1,T2,Tx)=>(1*T1+1*T2+1.5*Tx)/3;
const TRIMIN_fund=(P1,P2,S,goalTx)=>3*goalTx-(P1+P2+3*S);

/* ===== Estado ===== */
let TAB='fund';         // 'fund' | 'med'
let ACTION='fund_full'; // 'fund_full' | 'fund_tri_min' | 'med_full' | 'med_p2_min'

/* ===== UI ===== */
function setTab(t){
  TAB=t;
  $('#tabFund').classList.toggle('active',t==='fund');
  $('#tabMed').classList.toggle('active',t==='med');
  renderActions(); renderInputs(); clearOutputs();
}

function renderActions(){
  const box=$('#actions');
  if(TAB==='fund'){
    ACTION=ACTION.startsWith('fund_')?ACTION:'fund_full';
    box.innerHTML=`
      <button type="button" class="chip" data-act="fund_full">Média Anual</button>
      <button type="button" class="chip" data-act="fund_tri_min">Tri mínimo</button>`;
    $('#goalTxBlock').style.display='';
  }else{
    ACTION=ACTION.startsWith('med_')?ACTION:'med_full';
    box.innerHTML=`
      <button type="button" class="chip" data-act="med_full">Média Anual</button>
      <button type="button" class="chip" data-act="med_p2_min">P2 mínima</button>`;
    $('#goalTxBlock').style.display='none';
  }
  [...box.querySelectorAll('.chip')].forEach(btn=>{
    btn.classList.toggle('active',btn.dataset.act===ACTION);
    btn.addEventListener('click',()=>{
      ACTION=btn.dataset.act;
      [...box.querySelectorAll('.chip')].forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      clearOutputs(); renderInputs();
    });
  });
}

function renderInputs(){
  const a=$('#inputsArea');
  if(TAB==='fund'){
    if(ACTION==='fund_full'){
      a.innerHTML=`
        <div><label for="t1">T1</label><div class="inputWrap"><svg class="inputIcon" width="18" height="18" viewBox="0 0 24 24"><path fill="#8aa1ff" d="M5 3h14v2H5zm0 8h14v2H5zm0 8h14v2H5z"/></svg><input id="t1" placeholder="ex.: 7,0"></div></div>
        <div><label for="t2">T2</label><div class="inputWrap"><svg class="inputIcon" width="18" height="18" viewBox="0 0 24 24"><path fill="#8aa1ff" d="M5 3h14v2H5zm0 8h14v2H5zm0 8h14v2H5z"/></svg><input id="t2" placeholder="ex.: 8,0"></div></div>
        <div><label for="p1">P1</label><div class="inputWrap"><svg class="inputIcon" width="18" height="18" viewBox="0 0 24 24"><path fill="#86f7d9" d="M3 5h18v2H3zM3 11h18v2H3zM3 17h18v2H3z"/></svg><input id="p1" placeholder="ex.: 6,5"></div></div>
        <div><label for="p2">P2</label><div class="inputWrap"><svg class="inputIcon" width="18" height="18" viewBox="0 0 24 24"><path fill="#86f7d9" d="M3 5h18v2H3zM3 11h18v2H3zM3 17h18v2H3z"/></svg><input id="p2" placeholder="ex.: 7,2"></div></div>
        <div><label for="tri">Tri (trimestral)</label><div class="inputWrap"><svg class="inputIcon" width="18" height="18" viewBox="0 0 24 24"><path fill="#b388ff" d="M12 3l9 4.5v9L12 21 3 16.5v-9z"/></svg><input id="tri" placeholder="ex.: 4,0"></div></div>
        <div><label for="s">S (simulado)</label><div class="inputWrap"><svg class="inputIcon" width="18" height="18" viewBox="0 0 24 24"><path fill="#ffd479" d="M12 2l3 6 6 .5-4.5 4 1.3 6-5.8-3.2L6.2 18 7.5 12 3 8.5 9 8z"/></svg><input id="s" placeholder="ex.: 0,7"></div></div>`;
    }else{
      a.innerHTML=`
        <div><label for="p1">P1</label><div class="inputWrap"><svg class="inputIcon" width="18" height="18" viewBox="0 0 24 24"><path fill="#86f7d9" d="M3 5h18v2H3zM3 11h18v2H3zM3 17h18v2H3z"/></svg><input id="p1" placeholder="ex.: 6,5"></div></div>
        <div><label for="p2">P2</label><div class="inputWrap"><svg class="inputIcon" width="18" height="18" viewBox="0 0 24 24"><path fill="#86f7d9" d="M3 5h18v2H3zM3 11h18v2H3zM3 17h18v2H3z"/></svg><input id="p2" placeholder="ex.: 7,2"></div></div>
        <div><label for="s">S (simulado)</label><div class="inputWrap"><svg class="inputIcon" width="18" height="18" viewBox="0 0 24 24"><path fill="#ffd479" d="M12 2l3 6 6 .5-4.5 4 1.3 6-5.8-3.2L6.2 18 7.5 12 3 8.5 9 8z"/></svg><input id="s" placeholder="ex.: 0,7"></div></div>`;
    }
  }else{
    if(ACTION==='med_full'){
      /* Médio • Média Anual: apenas T1, T2, T3 */
      a.innerHTML=`
        <div><label for="t1">T1</label><div class="inputWrap"><svg class="inputIcon" width="18" height="18" viewBox="0 0 24 24"><path fill="#8aa1ff" d="M5 3h14v2H5zm0 8h14v2H5zm0 8h14v2H5z"/></svg><input id="t1" placeholder="ex.: 6,5"></div></div>
        <div><label for="t2">T2</label><div class="inputWrap"><svg class="inputIcon" width="18" height="18" viewBox="0 0 24 24"><path fill="#8aa1ff" d="M5 3h14v2H5zm0 8h14v2H5zm0 8h14v2H5z"/></svg><input id="t2" placeholder="ex.: 7,8"></div></div>
        <div><label for="t3">T3</label><div class="inputWrap"><svg class="inputIcon" width="18" height="18" viewBox="0 0 24 24"><path fill="#86f7d9" d="M3 5h18v2H3zM3 11h18v2H3zM3 17h18v2H3z"/></svg><input id="t3" placeholder="ex.: 7,0"></div></div>`;
    }else{
      a.innerHTML=`
        <div><label for="t1">T1</label><div class="inputWrap"><svg class="inputIcon" width="18" height="18" viewBox="0 0 24 24"><path fill="#8aa1ff" d="M5 3h14v2H5zm0 8h14v2H5zm0 8h14v2H5z"/></svg><input id="t1" placeholder="ex.: 6,5"></div></div>
        <div><label for="t2">T2</label><div class="inputWrap"><svg class="inputIcon" width="18" height="18" viewBox="0 0 24 24"><path fill="#8aa1ff" d="M5 3h14v2H5zm0 8h14v2H5zm0 8h14v2H5z"/></svg><input id="t2" placeholder="ex.: 7,8"></div></div>
        <div><label for="p1">P1 (3º tri)</label><div class="inputWrap"><svg class="inputIcon" width="18" height="18" viewBox="0 0 24 24"><path fill="#86f7d9" d="M3 5h18v2H3zM3 11h18v2H3zM3 17h18v2H3z"/></svg><input id="p1" placeholder="ex.: 5,5"></div></div>
        <div><label for="s">S (simulado)</label><div class="inputWrap"><svg class="inputIcon" width="18" height="18" viewBox="0 0 24 24"><path fill="#ffd479" d="M12 2l3 6 6 .5-4.5 4 1.3 6-5.8-3.2L6.2 18 7.5 12 3 8.5 9 8z"/></svg><input id="s" placeholder="ex.: 0,7"></div></div>
        <div><label for="goalMA">MA alvo</label><div class="inputWrap"><svg class="inputIcon" width="18" height="18" viewBox="0 0 24 24"><path fill="#b388ff" d="M12 3l9 4.5v9L12 21 3 16.5v-9z"/></svg><input id="goalMA" value="7,00"></div></div>`;
    }
  }
}

/* ===== Lógica de cálculo ===== */
function clearOutputs(){
  $('#maVal').textContent='MA —';
  $('#maCenter').textContent='—';
  $('#gsub').textContent='Meta: 7,00';
  $('#status').textContent='Status: —';
  setTag('#mainTag','—');
  setTag('#efTag','—');
  setGauge(0); setTable([]);
}

$('#btnCalc').addEventListener('click', ()=>{
  const T1=read('t1'), T2=read('t2'), T3=read('t3');
  const P1=read('p1'), P2=read('p2'), S=read('s'), TRI=read('tri');
  const goalMA=toNum($('#goalMA').value), goalTx=toNum($('#goalTx')?.value??'');

  function need(vals){
    if(vals.some(v=>!Number.isFinite(v))){toast('Preencha os campos necessários');return false}
    if(vals.some(v=>v<0||v>10)){toast('Notas devem estar entre 0 e 10');return false}
    return true;
  }

  if(TAB==='med' && ACTION==='med_full'){
    if(!need([T1,T2,T3]))return;
    const MA=(2*T1+2*T2+3*T3)/7;
    const EF=(50-7*MA)/3;
    showResults('Médio',MA,goalMA,[
      ['T1',fmt(T1),'1º trimestre'],
      ['T2',fmt(T2),'2º trimestre'],
      ['T3',fmt(T3),'3º trimestre'],
      ['MA',fmt(MA),'Média anual']
    ], EF);
  }
  else if(TAB==='med' && ACTION==='med_p2_min'){
    if(!need([T1,T2,P1,S,goalMA]))return;
    const T3need=(7*goalMA-2*T1-2*T2)/3;
    const p2min=2*T3need - P1 - 2*S;
    showResults('Médio',NaN,goalMA,[
      ['T1',fmt(T1),'1º trimestre'],
      ['T2',fmt(T2),'2º trimestre'],
      ['P1',fmt(P1),'3º trimestre'],
      ['S', fmt(S),'Simulado'],
      ['MA alvo',fmt(goalMA),'Meta']
    ], null, p2min);
  }
  else if(TAB==='fund' && ACTION==='fund_full'){
    if(!need([T1,T2,P1,P2,TRI,S]))return;
    const TX=(P1+P2+TRI+3*S)/3;
    const MA=(T1+T2+1.5*TX)/3;
    showResults('Fundamental',MA,goalMA,[
      ['T1',fmt(T1),'1º trimestre'],
      ['T2',fmt(T2),'2º trimestre'],
      ['P1',fmt(P1),'3º trimestre'],
      ['P2',fmt(P2),'3º trimestre'],
      ['Tri (trimestral)',fmt(TRI),'Trabalho'],
      ['S', fmt(S),'Simulado'],
      ['Média do 3º',fmt(TX),'Calculada']
    ]);
  }
  else if(TAB==='fund' && ACTION==='fund_tri_min'){
    if(!need([P1,P2,S,goalTx]))return;
    const triMin=3*goalTx - (P1+P2+3*S);
    showResults('Fundamental',NaN,goalTx,[
      ['P1',fmt(P1),'3º trimestre'],
      ['P2',fmt(P2),'3º trimestre'],
      ['S', fmt(S),'Simulado'],
      ['Tx alvo',fmt(goalTx),'Meta']
    ], null, null, triMin);
  }
});

function showResults(modo,MA,goal,rows,EF=null,P2min=null,TriMin=null){
  const g=Number.isFinite(goal)?goal:7;
  const maTxt=Number.isFinite(MA)?fmt(MA):'—';
  $('#maVal').textContent=`MA ${maTxt}`;
  $('#maCenter').textContent=maTxt;
  $('#gsub').textContent=`Meta: ${fmt(g)}`;
  const ok=Number.isFinite(MA)?(MA>=g):null;
  $('#status').textContent=Number.isFinite(MA)?(ok?'Status: aprovado':'Status: abaixo da meta'):'Status: —';
  const defMain=Number.isFinite(MA)?(ok?`MA ${fmt(MA)} ✔`:`MA ${fmt(MA)} ✖`):'—';
  setTag('#mainTag',defMain, ok==null?'':(ok?'ok':'bad'));

  // Exame Final
  if(modo==='Médio' && EF!==null){
    let label=`${fmt(EF)}`;
    let kind='mid';
    if(Number.isFinite(MA) && MA>=7){ label='0,00'; kind='ok'; }
    else if(EF<=0){ label='0,00'; kind='ok'; }
    else if(EF>10){ kind='bad'; }
    setTag('#efTag',label,kind);
  }else{
    setTag('#efTag','—');
  }

  // P2 mínima
  if(P2min!==null){
    const kind = P2min>10?'bad':(P2min<=0?'ok':'mid');
    setTag('#mainTag', P2min>10?`P2 mínima ${fmt(P2min)} (impossível)`:(P2min<=0?`P2 mínima 0,00`:`P2 mínima ${fmt(P2min)}`), kind);
  }

  // Tri mínimo
  if(TriMin!==null){
    const kind = TriMin>10?'bad':(TriMin<=0?'ok':'mid');
    setTag('#mainTag', TriMin>10?`Tri mínimo ${fmt(TriMin)} (impossível)`:(TriMin<=0?`Tri mínimo 0,00`:`Tri mínimo ${fmt(TriMin)}`), kind);
  }

  setGauge(Number.isFinite(MA)?Math.min(1,Math.max(0,MA/g)):0);
  setTable(rows);
}

/* limpar e exemplo */
$('#btnLimpar').addEventListener('click',()=>{$$('#inputsArea input').forEach(i=>i.value='');$('#goalMA').value='7,00';if($('#goalTx')){$('#goalTx').value='7,00'};clearOutputs();toast('Campos limpos')});
$('#btnExemplo').addEventListener('click',()=>{
  if(TAB==='med'){
    if(ACTION==='med_full'){
      $('#t1').value='6,50';$('#t2').value='7,80';$('#t3').value='7,00';$('#goalMA').value='7,00';
    }else{
      $('#t1').value='6,80';$('#t2').value='7,20';$('#p1').value='6,40';$('#s').value='0,80';$('#goalMA').value='7,00';
    }
  }else{
    if(ACTION==='fund_full'){
      $('#t1').value='7,00';$('#t2').value='8,00';$('#p1').value='6,50';$('#p2').value='7,20';$('#tri').value='4,00';$('#s').value='0,70';$('#goalMA').value='7,00';$('#goalTx').value='7,00';
    }else{
      $('#p1').value='6,50';$('#p2').value='7,20';$('#s').value='0,70';$('#goalTx').value='7,00';
    }
  }
  toast('Exemplo preenchido');
});

/* inicialização */
function init(){ setTab('fund'); }
init();
</script>
</body>
</html>
